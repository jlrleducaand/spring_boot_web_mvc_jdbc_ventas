<!DOCTYPE html SYSTEM "http://www.thymeleaf.org/dtd/xhtml1-strict-thymeleaf-4.dtd">
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Clientes</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
          integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css">

</head>
<body>
<div class="container">
    <div class="row">
        <div class="col-9">
            <h1 th:text="#{msg.pedidos}" >Pedidos</h1>
        </div>
        <div class="col-3">
            <form class="d-flex justify-content-between mt-5" action="/pedidos/crear">
                <input class="row btn-danger  px-5" type="submit" th:value="#{btn.crear}">
                <input class="btn-warning px-5" type="button" th:value="#{btn.volver}" onclick="location.href='/index';">
            </form>
        </div>
    </div>
    <div>
        <hr/>
    </div>
    <div class="row bg-primary  text-center  py-3 ">
        <div class="col-2  text-white" th:text="#{msg.id}" >Id</div>
        <div class="col-2  text-white" th:text="#{msg.total}" >Total</div>
        <div class="col-2  text-white" th:text="#{msg.fecha}" >Fecha</div>
        <div class="col-2  text-white" th:text="#{msg.id_cliente}" >Id_cliente</div>
        <div class="col-1  text-white" th:text="#{msg.id_comercial}" >Id_comercial</div>
        <div class="col-3  text-white" th:text="#{msg.operacion}" >Operación</div>
    </div>
    <div class="">
        <hr/>
    </div>

    <div class="row text-center py-2" th:each="pedido : ${listaPedidos}">
        <div class="col-2" th:text="${pedido.id}">0</div>
        <div class="col-2" th:text="${pedido.total}">total</div>
        <div class="col-2" th:text="${pedido.fecha}">fecha</div>
        <div class="col-2" th:text="${pedido.id_cliente}">id_cliente</div>
        <div class="col-1" th:text="${pedido.id_comercial}">id_comercial</div>
        <div class="col-3 " style="overflow: hidden;">
            <form th:action="@{/pedidos/__${pedido.id}__}" style="display: inline;">
                <input class="btn-success" type="submit" th:value="#{btn.ver.detalle}" value="Ver Detalle"/>
            </form>
            <form th:action="@{'/pedidos/editar/' + ${pedido.id}} " style="display: inline;">
                <input class="btn-warning" type="submit" th:value="#{btn.editar}" value="Editar"/>
            </form>
            <form th:action="@{/pedidos/borrar/{id} (id=${pedido.id})}" method="post" style="display: inline;">
                <input class="btn-danger" type="submit" th:value="#{btn.borrar}" value="Eliminar"/>
            </form>
        </div>
        <hr class="col-9 border-2">
    </div>

</div>
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
        integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
        crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js"
        integrity="sha384-BBtl+eGJRgqQAUMxJ7pMwbEyER4l1g+O15P+16Ep7Q9Q+zqX6gSbd85u4mG4QzX+"
        crossorigin="anonymous"></script>

<script th:inline="javascript">
    //DINAMISMO CON JQUERY..
    //CUANDO SE CARGA EL DOM JQUERY EJECUTA SOBRE SELECTOR DE CAPA MODAL AL MODAL
    $(function (){

        $('.btn.formdelete').click( function (eventObject) {
            let pedidoID = $(this).attr('data-pedido-id');
            $('#msgborrarpedidomodal').text([[#{msg.borrar.pedido}]]+ ' ' +pedidoID + '?')
            $('#newBorrarIDModal button.delete').attr('data-pedido-id', pedidoID);
            $('#newBorrarIDModal').modal('show');
        });

        $('#newBorrarIDModal').on('click', 'button.delete', function (eventObject) {
            let pedidoID = $(this).attr('data-pedido-id');
            document.forms['formdelete'+pedidoID].submit();
            $('#newBorrarIDModal').modal('hide');
        });

        $('#newBorrarIDModal').on('click', 'button.close', function (eventObject) {
            $('#newBorrarIDModal').modal('hide');
        });

    });
</script>

<script th:inline="javascript">
    $(function (){
        //IMPLEMENTANDO UN BOTÓN backToTop
        let btn = $('#backToTop');
        $(window).on('scroll', function() {
            if ($(window).scrollTop() > 300) {
                btn.addClass('show');
            } else {
                btn.removeClass('show');
            }
        });
        btn.on('click', function(e) {
            e.preventDefault();
            $('html, body').animate({
                scrollTop: 0
            }, '300');
        });

        let url = new URL(window.location.href);
        let valLang = url.searchParams.get('lang')


        /*[# th:if="${editPedidoID}"]*/
        $('html, body').animate({
            scrollTop: $('#'+[[${editPedidoID}]]).offset().top-137
        }, 1000, () => $('#'+[[${editPedidoID}]]).addClass('highlight'));
        /*[/]*/

    });

</script>
<th:block th:if="${newPedidoID}">
    <div class="modal fade" id="newGrabaIDModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel" th:text="#{msg.pedidos}">Pedidos</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body" th:text="|#{msg.grabo.pedido.ok} ${newPedidoID}|">
                    Grabado correctamente pedido con ID
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary close" data-dismiss="modal" th:text="#{btn.cerrar}" >Cerrar</button>
                </div>
            </div>
        </div>
    </div>
    <script th:inline="javascript">
        //DINAMISMO CON JQUERY..
        //CUANDO SE CARGA EL DOM JQUERY EJECUTA SOBRE SELECTOR DE CAPA MODAL AL MODAL
        $(function (){
            $('#newGrabaIDModal').modal('show');
            $('#newGrabaIDModal').on('click', 'button.close', function (eventObject) {
                $('#newGrabaIDModal').modal('hide');

                //PARA HACER SMOOTH SCROLL AL ELEMENTO NUEVO ELEMENTO EN LA PÁGINA
                $('html, body').animate({
                    scrollTop: $('#'+[[${newPedidoID}]]).offset().top
                }, 1000, () => $('#'+[[${newPedidoID}]]).addClass('highlight'));
            });
        });
    </script>
</th:block>
<script th:src="@{/js/bootstrap.bundle.js}" type="text/javascript" ></script>
</body>
</html>